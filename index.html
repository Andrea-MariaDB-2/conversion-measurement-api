<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Attribution Reporting</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2016/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 5c7bc9381, updated Wed May 12 18:18:08 2021 -0700" name="generator">
  <link href="https://wicg.github.io/conversion-measurement-api" rel="canonical">
  <meta content="0245c3e54c30dfd81d95da00d3f7bc02dd4ad23c" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Attribution Reporting</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Draft Community Group Report, <time class="dt-updated" datetime="2021-05-13">13 May 2021</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/conversion-measurement-api">https://wicg.github.io/conversion-measurement-api</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/conversion-measurement-api/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:csharrison@chromium.org">Charlie Harrison</a> (<a class="p-org org" href="https://google.com">Google Inc.</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2021 the Contributors to the Attribution Reporting Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>An API to report that an event may have been caused by another cross-site event. These reports are designed to transfer little enough data between sites that the sites can’t use them to track individual users.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#overview"><span class="secno">1.1</span> <span class="content">Overview</span></a>
     </ol>
    <li><a href="#fetch-monkeypatches"><span class="secno">2</span> <span class="content">Fetch monkeypatches</span></a>
    <li><a href="#html-monkeypatches"><span class="secno">3</span> <span class="content">HTML monkeypatches</span></a>
    <li>
     <a href="#structures"><span class="secno">4</span> <span class="content">Structures</span></a>
     <ol class="toc">
      <li><a href="#attribution-source"><span class="secno">4.1</span> <span class="content">Attribution source</span></a>
      <li><a href="#attribution-trigger"><span class="secno">4.2</span> <span class="content">Attribution trigger</span></a>
      <li><a href="#attribution-report"><span class="secno">4.3</span> <span class="content">Attribution report</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">5</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#parsing-attribution-destination"><span class="secno">5.1</span> <span class="content">Parsing an attribution destination</span></a>
      <li><a href="#obtaining-attribution-source-anchor"><span class="secno">5.2</span> <span class="content">Obtaining an attribution source from an <code>a</code> element</span></a>
      <li><a href="#attribution-trigger-creation"><span class="secno">5.3</span> <span class="content">Creating an attribution trigger</span></a>
      <li><a href="#triggering-attribution"><span class="secno">5.4</span> <span class="content">Triggering attribution</span></a>
      <li><a href="#parsing-data-fields"><span class="secno">5.5</span> <span class="content">Parsing data fields</span></a>
      <li><a href="#delivery-time"><span class="secno">5.6</span> <span class="content">Establishing report delivery time</span></a>
      <li><a href="#queuing-report"><span class="secno">5.7</span> <span class="content">Queuing a conversion report</span></a>
      <li><a href="#attribution-credit"><span class="secno">5.8</span> <span class="content">Establishing attribution credit</span></a>
     </ol>
    <li><a href="#security-considerations"><span class="secno">6</span> <span class="content">Security consideration</span></a>
    <li><a href="#privacy-considerations"><span class="secno">7</span> <span class="content">Privacy consideration</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is non-normative</em></p>
   <p>This specification describes how web browsers can provide a mechanism to the
web that supports measuring and attributing conversions (e.g. purchases) to ads
a user interacted with on another site. This mechanism should remove one need
for cross site identifiers like third party cookies.</p>
   <h3 class="heading settled" data-level="1.1" id="overview"><span class="secno">1.1. </span><span class="content">Overview</span><a class="self-link" href="#overview"></a></h3>
   <p>A page can register an <a data-link-type="dfn" href="#attribution-source" id="ref-for-attribution-source">attribution source</a> on a site by providing <code><a data-link-type="element-sub" href="#element-attrdef-a-attributionsourceeventid" id="ref-for-element-attrdef-a-attributionsourceeventid">attributionsourceeventid</a></code> and <code><a data-link-type="element-sub" href="#element-attrdef-a-attributiondestination" id="ref-for-element-attrdef-a-attributiondestination">attributiondestination</a></code> attributes on an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element">a</a></code> element.
When such an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element①">a</a></code> element is clicked, and the resulting navigation commits in a document within the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-site" id="ref-for-same-site">same site</a> as
the <code><a data-link-type="element-sub" href="#element-attrdef-a-attributiondestination" id="ref-for-element-attrdef-a-attributiondestination①">attributiondestination</a></code>, the <a data-link-type="dfn" href="#attribution-source" id="ref-for-attribution-source①">attribution source</a> is stored in UA storage.</p>
   <p>At a later point, the <code><a data-link-type="element-sub" href="#element-attrdef-a-attributiondestination" id="ref-for-element-attrdef-a-attributiondestination②">attributiondestination</a></code> site may fire an HTTP request to
trigger attribution, which matches an <a data-link-type="dfn" href="#attribution-trigger" id="ref-for-attribution-trigger">attribution trigger</a> with any previously
stored sources. If matching sources exist, they are scheduled to be
reported at a later time, possibly multiple days in the future.</p>
   <p>Reports are sent to reporting endpoints that are configured in the attribution source
and attribution trigger.</p>
   <h2 class="heading settled" data-level="2" id="fetch-monkeypatches"><span class="secno">2. </span><span class="content">Fetch monkeypatches</span><a class="self-link" href="#fetch-monkeypatches"></a></h2>
   <p class="issue" id="issue-701ea956"><a class="self-link" href="#issue-701ea956"></a> Patch into fetch for cancelling requests redirected to the .well-known
conversion domain.</p>
   <h2 class="heading settled" data-level="3" id="html-monkeypatches"><span class="secno">3. </span><span class="content">HTML monkeypatches</span><a class="self-link" href="#html-monkeypatches"></a></h2>
   <p>Add the following content attributes to the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element②">a</a></code> element:</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#htmlanchorelement" id="ref-for-htmlanchorelement"><c- g>HTMLAnchorElement</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions"><c- g>CEReactions</c-></a>, <a class="idl-code" data-link-type="extended-attribute"><c- g>Reflect</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="HTMLAnchorElement" data-dfn-type="attribute" data-export data-type="DOMString" id="dom-htmlanchorelement-attributiondestination"><code><c- g>attributiondestination</c-></code><a class="self-link" href="#dom-htmlanchorelement-attributiondestination"></a></dfn>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions①"><c- g>CEReactions</c-></a>, <a class="idl-code" data-link-type="extended-attribute"><c- g>Reflect</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="HTMLAnchorElement" data-dfn-type="attribute" data-export data-type="DOMString" id="dom-htmlanchorelement-attributionsourceeventid"><code><c- g>attributionsourceeventid</c-></code><a class="self-link" href="#dom-htmlanchorelement-attributionsourceeventid"></a></dfn>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions②"><c- g>CEReactions</c-></a>, <a class="idl-code" data-link-type="extended-attribute"><c- g>Reflect</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="HTMLAnchorElement" data-dfn-type="attribute" data-export data-type="DOMString" id="dom-htmlanchorelement-attributionreportto"><code><c- g>attributionreportto</c-></code><a class="self-link" href="#dom-htmlanchorelement-attributionreportto"></a></dfn>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions③"><c- g>CEReactions</c-></a>, <a class="idl-code" data-link-type="extended-attribute"><c- g>Reflect</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="idl-code" data-dfn-for="HTMLAnchorElement" data-dfn-type="attribute" data-export data-type="unsigned long long" id="dom-htmlanchorelement-attributionexpiry"><code><c- g>attributionexpiry</c-></code><a class="self-link" href="#dom-htmlanchorelement-attributionexpiry"></a></dfn>;
};
</pre>
   <p>The <dfn class="dfn-paneled" data-dfn-for="a" data-dfn-type="element-attr" data-export id="element-attrdef-a-attributiondestination"><code>attributiondestination</code></dfn> is an <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a> that is intended to be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-site" id="ref-for-same-site①">same site</a> with the origin of the final navigation url resulting 
from running <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#following-hyperlinks-2" id="ref-for-following-hyperlinks-2">follow the hyperlink</a> with the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element③">a</a></code> element.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-for="a" data-dfn-type="element-attr" data-export id="element-attrdef-a-attributionsourceeventid"><code>attributionsourceeventid</code></dfn> is a string
containing information about the <code>attribution source</code> and will be supplied in the <a data-link-type="dfn" href="#attribution-report" id="ref-for-attribution-report">attribution report</a>.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-for="a" data-dfn-type="element-attr" data-export id="element-attrdef-a-attributionreportto"><code>attributionreportto</code></dfn> optionally declares the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin">origin</a> to send the <a data-link-type="dfn" href="#attribution-report" id="ref-for-attribution-report①">attribution report</a> for this source.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-for="a" data-dfn-type="element-attr" data-export id="element-attrdef-a-attributionexpiry"><code>attributionexpiry</code></dfn> optionally defines the amount
of time in milliseconds the attribution source should be considered for reporting.</p>
   <p class="issue" id="issue-601c1f4b"><a class="self-link" href="#issue-601c1f4b"></a> Need monkey patches passing attribution source in navigation, and a mechanism
for validating the resulting document matches the attributiondestination.</p>
   <h2 class="heading settled" data-level="4" id="structures"><span class="secno">4. </span><span class="content">Structures</span><a class="self-link" href="#structures"></a></h2>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.1" data-lt="Attribution source" data-noexport id="attribution-source"><span class="secno">4.1. </span><span class="content">Attribution source</span><a class="self-link" href="#attribution-source" id="ref-for-attribution-source④"></a></h3>
   <p>An attribution source is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> with the following items:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution source" data-dfn-type="dfn" data-noexport id="attribution-source-source-origin">source origin</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution source" data-dfn-type="dfn" data-noexport id="attribution-source-event-id">event id</dfn>
    <dd data-md>
     <p>A non-negative 64-bit integer.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution source" data-dfn-type="dfn" data-noexport id="attribution-source-attribution-destination">attribution destination</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin②">origin</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution source" data-dfn-type="dfn" data-noexport id="attribution-source-reporting-endpoint">reporting endpoint</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin③">origin</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution source" data-dfn-type="dfn" data-noexport id="attribution-source-expiry">expiry</dfn>
    <dd data-md>
     <p>A point in time.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution source" data-dfn-type="dfn" data-noexport id="attribution-source-source-time">source time</dfn>
    <dd data-md>
     <p>A point in time.</p>
   </dl>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.2" data-lt="Attribution trigger" data-noexport id="attribution-trigger"><span class="secno">4.2. </span><span class="content">Attribution trigger</span><a class="self-link" href="#attribution-trigger" id="ref-for-attribution-trigger②"></a></h3>
   <p>An attribution trigger is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> with the following items:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution trigger" data-dfn-type="dfn" data-noexport id="attribution-trigger-trigger-origin">trigger origin</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin④">origin</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution trigger" data-dfn-type="dfn" data-noexport id="attribution-trigger-trigger-data">trigger data</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">string</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution trigger" data-dfn-type="dfn" data-noexport id="attribution-trigger-trigger-time">trigger time</dfn>
    <dd data-md>
     <p>A point in time.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution trigger" data-dfn-type="dfn" data-noexport id="attribution-trigger-reporting-endpoint">reporting endpoint</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin⑤">origin</a>.</p>
   </dl>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.3" data-lt="Attribution report" data-noexport id="attribution-report"><span class="secno">4.3. </span><span class="content">Attribution report</span><a class="self-link" href="#attribution-report" id="ref-for-attribution-report②"></a></h3>
   <p>An attribution report is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct②">struct</a> with the following items:</p>
   <dl>
    <dt data-md><dfn data-dfn-for="attribution report" data-dfn-type="dfn" data-noexport id="attribution-report-event-id">event id<a class="self-link" href="#attribution-report-event-id"></a></dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①">string</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="attribution report" data-dfn-type="dfn" data-noexport id="attribution-report-trigger-data">trigger data</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②">string</a>.</p>
    <dt data-md><dfn data-dfn-for="attribution report" data-dfn-type="dfn" data-noexport id="attribution-report-credit">credit<a class="self-link" href="#attribution-report-credit"></a></dfn>
    <dd data-md>
     <p>An integer in the range [0, 100].</p>
   </dl>
   <h2 class="heading settled" data-level="5" id="algorithms"><span class="secno">5. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
   <h3 class="heading settled algorithm" data-algorithm="Parsing an attribution destination" data-level="5.1" id="parsing-attribution-destination"><span class="secno">5.1. </span><span class="content">Parsing an attribution destination</span><a class="self-link" href="#parsing-attribution-destination"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parse-an-attribution-destination">parse an attribution destination</dfn> from a string <var>str</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>url</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> on the value of
the <var>str</var>.</p>
    <li data-md>
     <p>If <var>url</var> is failure or null, return null.</p>
    <li data-md>
     <p>Return the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#obtain-a-site" id="ref-for-obtain-a-site">obtaining a site</a> from <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin⑥">origin</a>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Obtaining an attribution source from an a element" data-level="5.2" id="obtaining-attribution-source-anchor"><span class="secno">5.2. </span><span class="content">Obtaining an attribution source from an <code>a</code> element</span><a class="self-link" href="#obtaining-attribution-source-anchor"></a></h3>
   <p>To <dfn data-dfn-type="dfn" data-noexport id="obtain-an-attribution-source">obtain an attribution source<a class="self-link" href="#obtain-an-attribution-source"></a></dfn> from an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element" id="ref-for-the-a-element④">a</a></code> element <var>anchor</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>currentTime</var> be the current time.</p>
    <li data-md>
     <p>If <var>anchor</var> does not have both an <code><a data-link-type="element-sub" href="#element-attrdef-a-attributiondestination" id="ref-for-element-attrdef-a-attributiondestination③">attributiondestination</a></code> attribute and
an <code><a data-link-type="element-sub" href="#element-attrdef-a-attributionsourceeventid" id="ref-for-element-attrdef-a-attributionsourceeventid①">attributionsourceeventid</a></code> attribute, return null.</p>
    <li data-md>
     <p>Let <var>attributionDestination</var> be the result of running <a data-link-type="dfn" href="#parse-an-attribution-destination" id="ref-for-parse-an-attribution-destination">parse an attribution destination</a> with anchor’s <code><a data-link-type="element-sub" href="#element-attrdef-a-attributiondestination" id="ref-for-element-attrdef-a-attributiondestination④">attributiondestination</a></code> attribute.</p>
    <li data-md>
     <p>If <var>attributionDestination</var> is null, return null.</p>
    <li data-md>
     <p>Let <var>sourceOrigin</var> be <var>anchor</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin">top-level origin</a>.</p>
    <li data-md>
     <p>Let <var>reportingOrigin</var> be <var>sourceOrigin</var>.</p>
    <li data-md>
     <p>If <var>anchor</var> has an <code><a data-link-type="element-sub" href="#element-attrdef-a-attributionreportto" id="ref-for-element-attrdef-a-attributionreportto">attributionreportto</a></code> attribute, then:</p>
     <ol>
      <li data-md>
       <p>Let <var>reportingUrl</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser①">URL parser</a> with <var>anchor</var>’s <code><a data-link-type="element-sub" href="#element-attrdef-a-attributionreportto" id="ref-for-element-attrdef-a-attributionreportto①">attributionreportto</a></code> value</p>
      <li data-md>
       <p>If <var>reportingUrl</var> is failure or null, return null.</p>
      <li data-md>
       <p>Set <var>reportingOrigin</var> to <var>reportingUrl</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin⑦">origin</a>.</p>
     </ol>
    <li data-md>
     <p>Let <var>expiry</var> be 30 days.</p>
    <li data-md>
     <p>If <var>anchor</var> has an <code><a data-link-type="element-sub" href="#element-attrdef-a-attributionexpiry" id="ref-for-element-attrdef-a-attributionexpiry">attributionexpiry</a></code> attribute, and applying the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#rules-for-parsing-non-negative-integers" id="ref-for-rules-for-parsing-non-negative-integers">rules for parsing non-negative integers</a> to the attributes’s value
results in a number greater than zero, then set <var>expiry</var> to that value.</p>
    <li data-md>
     <p>Let <var>source</var> be a new <a data-link-type="dfn" href="#attribution-source" id="ref-for-attribution-source②">attribution source</a> struct whose items are:</p>
     <dl>
      <dt data-md><a data-link-type="dfn" href="#attribution-source-source-origin" id="ref-for-attribution-source-source-origin">source origin</a>
      <dd data-md>
       <p><var>sourceOrigin</var></p>
      <dt data-md><a data-link-type="dfn" href="#attribution-source-event-id" id="ref-for-attribution-source-event-id">event id</a>
      <dd data-md>
       <p>The result of running <a data-link-type="dfn" href="#parse-attribution-data" id="ref-for-parse-attribution-data">parse attribution data</a> with <var>anchor</var>’s <code><a data-link-type="element-sub" href="#element-attrdef-a-attributionsourceeventid" id="ref-for-element-attrdef-a-attributionsourceeventid②">attributionsourceeventid</a></code> attribute modulo <a data-link-type="dfn" href="#max-event-id-value" id="ref-for-max-event-id-value">max event id value</a>.</p>
      <dt data-md><a data-link-type="dfn" href="#attribution-source-attribution-destination" id="ref-for-attribution-source-attribution-destination">attribution destination</a>
      <dd data-md>
       <p><var>attributionDestination</var></p>
      <dt data-md><a data-link-type="dfn" href="#attribution-source-reporting-endpoint" id="ref-for-attribution-source-reporting-endpoint">reporting endpoint</a>
      <dd data-md>
       <p><var>reportingOrigin</var></p>
      <dt data-md><a data-link-type="dfn" href="#attribution-source-expiry" id="ref-for-attribution-source-expiry">expiry</a>
      <dd data-md>
       <p><var>currentTime</var> + <var>expiry</var></p>
      <dt data-md><a data-link-type="dfn" href="#attribution-source-source-time" id="ref-for-attribution-source-source-time">source time</a>
      <dd data-md>
       <p><var>currentTime</var></p>
     </dl>
    <li data-md>
     <p>Return <var>source</var></p>
   </ol>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="max-event-id-value">Max event id value</dfn> is a vendor specific integer which controls
the maximum size value which can be used as an <a data-link-type="dfn" href="#attribution-source-event-id" id="ref-for-attribution-source-event-id①">event id</a></p>
   <p class="issue" id="issue-f9c115e6"><a class="self-link" href="#issue-f9c115e6"></a> Need to spec how to store the attribution source.</p>
   <h3 class="heading settled algorithm" data-algorithm="Creating an attribution trigger" data-level="5.3" id="attribution-trigger-creation"><span class="secno">5.3. </span><span class="content">Creating an attribution trigger</span><a class="self-link" href="#attribution-trigger-creation"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-an-attribution-trigger">obtain an attribution trigger</dfn> given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">url</a> <var>url</var> and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a> <var>environment</var>, return a <a data-link-type="dfn" href="#attribution-trigger" id="ref-for-attribution-trigger①">attribution trigger</a> with the items:</p>
   <dl>
    <dt data-md><a data-link-type="dfn" href="#attribution-trigger-trigger-origin" id="ref-for-attribution-trigger-trigger-origin">trigger origin</a>
    <dd data-md>
     <p><var>environment</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin①">top-level origin</a>.</p>
    <dt data-md><a data-link-type="dfn" href="#attribution-trigger-trigger-data" id="ref-for-attribution-trigger-trigger-data">trigger data</a>
    <dd data-md>
     <p>The result of applying <a data-link-type="dfn" href="#parse-attribution-data" id="ref-for-parse-attribution-data①">parse attribution data</a> with the value associated with the <code>"data"</code> field of <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-query" id="ref-for-concept-url-query">query</a> modulo the user agent’s <a data-link-type="dfn" href="#max-trigger-data-value" id="ref-for-max-trigger-data-value">max trigger data value</a>.</p>
    <dt data-md><a data-link-type="dfn" href="#attribution-trigger-trigger-time" id="ref-for-attribution-trigger-trigger-time">trigger time</a>
    <dd data-md>
     <p>The current time.</p>
    <dt data-md><a data-link-type="dfn" href="#attribution-trigger-reporting-endpoint" id="ref-for-attribution-trigger-reporting-endpoint">reporting endpoint</a>
    <dd data-md>
     <p><var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin⑧">origin</a></p>
   </dl>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="max-trigger-data-value">Max trigger data value</dfn> is a vendor specific integer which controls the potential values of <a data-link-type="dfn" href="#attribution-report-trigger-data" id="ref-for-attribution-report-trigger-data">trigger data</a>.</p>
   <p class="issue" id="issue-9d1372db"><a class="self-link" href="#issue-9d1372db"></a> Formalize how to parse the query similar to URLSearchParams.</p>
   <h3 class="heading settled algorithm" data-algorithm="Triggering attribution" data-level="5.4" id="triggering-attribution"><span class="secno">5.4. </span><span class="content">Triggering attribution</span><a class="self-link" href="#triggering-attribution"></a></h3>
   <p>To <dfn data-dfn-type="dfn" data-noexport id="trigger-attribution">trigger attribution<a class="self-link" href="#trigger-attribution"></a></dfn> from a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> <var>request</var>, run the following steps:</p>
   <ol>
    <li data-md>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url">current url’s</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path">path</a> is not <code>.well-known/attribution-reporting/trigger-attribution</code>,
return.</p>
    <li data-md>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-redirect-count" id="ref-for-concept-request-redirect-count">redirect count</a> is less than 1, return.</p>
    <li data-md>
     <p>Let <var>previousUrl</var> be the second to last <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URL</a> in <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url-list" id="ref-for-concept-request-url-list">URL list</a>.</p>
    <li data-md>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url①">current url’s</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin⑨">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin">same origin</a> with <var>previousUrl</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①⓪">origin</a>, return.</p>
    <li data-md>
     <p>Let <var>trigger</var> be the result of running <a data-link-type="dfn" href="#obtain-an-attribution-trigger" id="ref-for-obtain-an-attribution-trigger">obtain an attribution trigger</a> with <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url②">current url</a> and <var>request</var>’s client.</p>
     <p class="note" role="note"><span>Note:</span> the restriction to require a redirect is needed to ensure that the
request’s origin is aware and in control of triggering attribution.</p>
    <li data-md>
     <p class="issue" id="issue-03498328"><a class="self-link" href="#issue-03498328"></a> Need to spec how to store <var>trigger</var>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Parsing data fields" data-level="5.5" id="parsing-data-fields"><span class="secno">5.5. </span><span class="content">Parsing data fields</span><a class="self-link" href="#parsing-data-fields"></a></h3>
   <p>This section defines how to parse and extract both <a data-link-type="dfn" href="#attribution-source-event-id" id="ref-for-attribution-source-event-id②">event id</a> and <a data-link-type="dfn" href="#attribution-trigger-trigger-data" id="ref-for-attribution-trigger-trigger-data①">trigger data</a>.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parse-attribution-data">parse attribution data</dfn> given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③">string</a> <var>input</var> modulo an integer <var>maxData</var> perform the following steps. They return a non-negative integer:</p>
   <ol>
    <li data-md>
     <p>Let <var>decodedInput</var> be the result of applying the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#rules-for-parsing-non-negative-integers" id="ref-for-rules-for-parsing-non-negative-integers①">rules for parsing non-negative integers</a> to <var>input</var>.</p>
    <li data-md>
     <p>If <var>decodedInput</var> is an error, return zero.</p>
    <li data-md>
     <p>If <var>decodedInput</var> is greater than 2<sup>64</sup>, return zero.</p>
    <li data-md>
     <p>Let <var>clampedDecodedInput</var> be the remainder when dividing <var>decodedInput</var> by <var>maxData</var>.</p>
    <li data-md>
     <p>Return <var>clampedDecodedInput</var>.</p>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Establishing report delivery time" data-level="5.6" id="delivery-time"><span class="secno">5.6. </span><span class="content">Establishing report delivery time</span><a class="self-link" href="#delivery-time"></a></h3>
   <p>To <dfn data-dfn-type="dfn" data-noexport id="obtain-a-report-delivery-time">obtain a report delivery time<a class="self-link" href="#obtain-a-report-delivery-time"></a></dfn> given an <a data-link-type="dfn" href="#attribution-source" id="ref-for-attribution-source③">attribution source</a> <var>source</var> and a <a data-link-type="dfn" href="#attribution-trigger-trigger-time" id="ref-for-attribution-trigger-trigger-time①">trigger time</a> <var>triggerTime</var> perform the  following steps. They
return a point in time.</p>
   <ol>
    <li data-md>
     <p>Let <var>timeToTrigger</var> be the difference between <var>triggerTime</var> and <a data-link-type="dfn" href="#attribution-source-source-time" id="ref-for-attribution-source-source-time①">source time</a>.</p>
    <li data-md>
     <p>Let <var>expiryDelta</var> be the difference between the <var>source</var>’s <a data-link-type="dfn" href="#attribution-source-expiry" id="ref-for-attribution-source-expiry①">expiry</a> and
the <var>source</var>’s <a data-link-type="dfn" href="#attribution-source-source-time" id="ref-for-attribution-source-source-time②">source time</a></p>
     <p class="note" role="note"><span>Note:</span> <var>timeToTrigger</var> is less than <var>expiryDelta</var> because it is not normally possible to
convert an expired attribution source.</p>
    <li data-md>
     <p>If:</p>
     <dl class="switch">
      <dt><var>timeToTrigger</var> &lt;= (2 days - 1 hour)
      <dd>return <a data-link-type="dfn" href="#attribution-source-source-time" id="ref-for-attribution-source-source-time③">source time</a> + 2 days.
      <dt>
        <var>expiryDelta</var> > (2 days - 1 hour) 
       <ul>
        <li data-md>
         <p>and <var>expiryDelta</var> &lt; (7 days - 1 hour)</p>
        <li data-md>
         <p>and <var>timeToTrigger</var> &lt;= <var>expiryDelta</var></p>
       </ul>
      <dd>return <var>source</var>’s <a data-link-type="dfn" href="#attribution-source-expiry" id="ref-for-attribution-source-expiry②">expiry</a> + 1 hour.
      <dt><var>timeToTrigger</var> &lt;= (7 days - 1 hour)
      <dd>return <a data-link-type="dfn" href="#attribution-source-source-time" id="ref-for-attribution-source-source-time④">source time</a> + 7 days
      <dt>Otherwise
      <dd>return <var>source</var>’s <a data-link-type="dfn" href="#attribution-source-expiry" id="ref-for-attribution-source-expiry③">expiry</a> + 1 hour.
     </dl>
   </ol>
   <h3 class="heading settled algorithm" data-algorithm="Queuing a conversion report" data-level="5.7" id="queuing-report"><span class="secno">5.7. </span><span class="content">Queuing a conversion report</span><a class="self-link" href="#queuing-report"></a></h3>
    TODO 
   <h3 class="heading settled algorithm" data-algorithm="Establishing attribution credit" data-level="5.8" id="attribution-credit"><span class="secno">5.8. </span><span class="content">Establishing attribution credit</span><a class="self-link" href="#attribution-credit"></a></h3>
    TODO 
   <h2 class="heading settled" data-level="6" id="security-considerations"><span class="secno">6. </span><span class="content">Security consideration</span><a class="self-link" href="#security-considerations"></a></h2>
    TODO 
   <h2 class="heading settled" data-level="7" id="privacy-considerations"><span class="secno">7. </span><span class="content">Privacy consideration</span><a class="self-link" href="#privacy-considerations"></a></h2>
    TODO 
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note. </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#attribution-source-attribution-destination">attribution destination</a><span>, in §4.1</span>
   <li>
    attributiondestination
    <ul>
     <li><a href="#dom-htmlanchorelement-attributiondestination">attribute for HTMLAnchorElement</a><span>, in §3</span>
     <li><a href="#element-attrdef-a-attributiondestination">element-attr for a</a><span>, in §3</span>
    </ul>
   <li>
    attributionexpiry
    <ul>
     <li><a href="#dom-htmlanchorelement-attributionexpiry">attribute for HTMLAnchorElement</a><span>, in §3</span>
     <li><a href="#element-attrdef-a-attributionexpiry">element-attr for a</a><span>, in §3</span>
    </ul>
   <li><a href="#attribution-report">Attribution report</a><span>, in §4.2</span>
   <li>
    attributionreportto
    <ul>
     <li><a href="#dom-htmlanchorelement-attributionreportto">attribute for HTMLAnchorElement</a><span>, in §3</span>
     <li><a href="#element-attrdef-a-attributionreportto">element-attr for a</a><span>, in §3</span>
    </ul>
   <li><a href="#attribution-source">Attribution source</a><span>, in §4</span>
   <li>
    attributionsourceeventid
    <ul>
     <li><a href="#dom-htmlanchorelement-attributionsourceeventid">attribute for HTMLAnchorElement</a><span>, in §3</span>
     <li><a href="#element-attrdef-a-attributionsourceeventid">element-attr for a</a><span>, in §3</span>
    </ul>
   <li><a href="#attribution-trigger">Attribution trigger</a><span>, in §4.1</span>
   <li><a href="#attribution-report-credit">credit</a><span>, in §4.3</span>
   <li>
    event id
    <ul>
     <li><a href="#attribution-report-event-id">dfn for attribution report</a><span>, in §4.3</span>
     <li><a href="#attribution-source-event-id">dfn for attribution source</a><span>, in §4.1</span>
    </ul>
   <li><a href="#attribution-source-expiry">expiry</a><span>, in §4.1</span>
   <li><a href="#max-event-id-value">Max event id value</a><span>, in §5.2</span>
   <li><a href="#max-trigger-data-value">Max trigger data value</a><span>, in §5.3</span>
   <li><a href="#obtain-an-attribution-source">obtain an attribution source</a><span>, in §5.2</span>
   <li><a href="#obtain-an-attribution-trigger">obtain an attribution trigger</a><span>, in §5.3</span>
   <li><a href="#obtain-a-report-delivery-time">obtain a report delivery time</a><span>, in §5.6</span>
   <li><a href="#parse-an-attribution-destination">parse an attribution destination</a><span>, in §5.1</span>
   <li><a href="#parse-attribution-data">parse attribution data</a><span>, in §5.5</span>
   <li>
    reporting endpoint
    <ul>
     <li><a href="#attribution-source-reporting-endpoint">dfn for attribution source</a><span>, in §4.1</span>
     <li><a href="#attribution-trigger-reporting-endpoint">dfn for attribution trigger</a><span>, in §4.2</span>
    </ul>
   <li><a href="#attribution-source-source-origin">source origin</a><span>, in §4.1</span>
   <li><a href="#attribution-source-source-time">source time</a><span>, in §4.1</span>
   <li><a href="#trigger-attribution">trigger attribution</a><span>, in §5.4</span>
   <li>
    trigger data
    <ul>
     <li><a href="#attribution-report-trigger-data">dfn for attribution report</a><span>, in §4.3</span>
     <li><a href="#attribution-trigger-trigger-data">dfn for attribution trigger</a><span>, in §4.2</span>
    </ul>
   <li><a href="#attribution-trigger-trigger-origin">trigger origin</a><span>, in §4.2</span>
   <li><a href="#attribution-trigger-trigger-time">trigger time</a><span>, in §4.2</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-concept-request-current-url">
   <a href="https://fetch.spec.whatwg.org/#concept-request-current-url">https://fetch.spec.whatwg.org/#concept-request-current-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-current-url">5.4. Triggering attribution</a> <a href="#ref-for-concept-request-current-url①">(2)</a> <a href="#ref-for-concept-request-current-url②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-redirect-count">
   <a href="https://fetch.spec.whatwg.org/#concept-request-redirect-count">https://fetch.spec.whatwg.org/#concept-request-redirect-count</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-redirect-count">5.4. Triggering attribution</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request">https://fetch.spec.whatwg.org/#concept-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request">5.4. Triggering attribution</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-url-list">
   <a href="https://fetch.spec.whatwg.org/#concept-request-url-list">https://fetch.spec.whatwg.org/#concept-request-url-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-url-list">5.4. Triggering attribution</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-cereactions">
   <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions">https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cereactions">3. HTML monkeypatches</a> <a href="#ref-for-cereactions①">(2)</a> <a href="#ref-for-cereactions②">(3)</a> <a href="#ref-for-cereactions③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-htmlanchorelement">
   <a href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#htmlanchorelement">https://html.spec.whatwg.org/multipage/text-level-semantics.html#htmlanchorelement</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-htmlanchorelement">3. HTML monkeypatches</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-a-element">
   <a href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element">https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-a-element">1.1. Overview</a> <a href="#ref-for-the-a-element①">(2)</a>
    <li><a href="#ref-for-the-a-element②">3. HTML monkeypatches</a> <a href="#ref-for-the-a-element③">(2)</a>
    <li><a href="#ref-for-the-a-element④">5.2. Obtaining an attribution source from an a element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-environment-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-environment-settings-object">5.3. Creating an attribution trigger</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-following-hyperlinks-2">
   <a href="https://html.spec.whatwg.org/multipage/links.html#following-hyperlinks-2">https://html.spec.whatwg.org/multipage/links.html#following-hyperlinks-2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-following-hyperlinks-2">3. HTML monkeypatches</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-obtain-a-site">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#obtain-a-site">https://html.spec.whatwg.org/multipage/origin.html#obtain-a-site</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-obtain-a-site">5.1. Parsing an attribution destination</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin">https://html.spec.whatwg.org/multipage/origin.html#concept-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin">3. HTML monkeypatches</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-relevant-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relevant-settings-object">5.2. Obtaining an attribution source from an a element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-rules-for-parsing-non-negative-integers">
   <a href="https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#rules-for-parsing-non-negative-integers">https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#rules-for-parsing-non-negative-integers</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-rules-for-parsing-non-negative-integers">5.2. Obtaining an attribution source from an a element</a>
    <li><a href="#ref-for-rules-for-parsing-non-negative-integers①">5.5. Parsing data fields</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-same-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#same-origin">https://html.spec.whatwg.org/multipage/origin.html#same-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-same-origin">5.4. Triggering attribution</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-same-site">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#same-site">https://html.spec.whatwg.org/multipage/origin.html#same-site</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-same-site">1.1. Overview</a>
    <li><a href="#ref-for-same-site①">3. HTML monkeypatches</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-environment-top-level-origin">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin">https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-environment-top-level-origin">5.2. Obtaining an attribution source from an a element</a>
    <li><a href="#ref-for-concept-environment-top-level-origin①">5.3. Creating an attribution trigger</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-string">
   <a href="https://infra.spec.whatwg.org/#string">https://infra.spec.whatwg.org/#string</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-string">4.2. Attribution trigger</a>
    <li><a href="#ref-for-string①">4.3. Attribution report</a> <a href="#ref-for-string②">(2)</a>
    <li><a href="#ref-for-string③">5.5. Parsing data fields</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct">
   <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct">4.1. Attribution source</a>
    <li><a href="#ref-for-struct①">4.2. Attribution trigger</a>
    <li><a href="#ref-for-struct②">4.3. Attribution report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-origin">
   <a href="https://url.spec.whatwg.org/#concept-url-origin">https://url.spec.whatwg.org/#concept-url-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-origin">3. HTML monkeypatches</a>
    <li><a href="#ref-for-concept-url-origin①">4.1. Attribution source</a> <a href="#ref-for-concept-url-origin②">(2)</a> <a href="#ref-for-concept-url-origin③">(3)</a>
    <li><a href="#ref-for-concept-url-origin④">4.2. Attribution trigger</a> <a href="#ref-for-concept-url-origin⑤">(2)</a>
    <li><a href="#ref-for-concept-url-origin⑥">5.1. Parsing an attribution destination</a>
    <li><a href="#ref-for-concept-url-origin⑦">5.2. Obtaining an attribution source from an a element</a>
    <li><a href="#ref-for-concept-url-origin⑧">5.3. Creating an attribution trigger</a>
    <li><a href="#ref-for-concept-url-origin⑨">5.4. Triggering attribution</a> <a href="#ref-for-concept-url-origin①⓪">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-path">
   <a href="https://url.spec.whatwg.org/#concept-url-path">https://url.spec.whatwg.org/#concept-url-path</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-path">5.4. Triggering attribution</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-query">
   <a href="https://url.spec.whatwg.org/#concept-url-query">https://url.spec.whatwg.org/#concept-url-query</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-query">5.3. Creating an attribution trigger</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url">
   <a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url">5.3. Creating an attribution trigger</a>
    <li><a href="#ref-for-concept-url①">5.4. Triggering attribution</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-parser">
   <a href="https://url.spec.whatwg.org/#concept-url-parser">https://url.spec.whatwg.org/#concept-url-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-parser">5.1. Parsing an attribution destination</a>
    <li><a href="#ref-for-concept-url-parser①">5.2. Obtaining an attribution source from an a element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://heycam.github.io/webidl/#idl-DOMString">https://heycam.github.io/webidl/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">3. HTML monkeypatches</a> <a href="#ref-for-idl-DOMString①">(2)</a> <a href="#ref-for-idl-DOMString②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-long-long">
   <a href="https://heycam.github.io/webidl/#idl-unsigned-long-long">https://heycam.github.io/webidl/#idl-unsigned-long-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-long-long">3. HTML monkeypatches</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-request-current-url">current url</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-redirect-count">redirect count</span>
     <li><span class="dfn-paneled" id="term-for-concept-request">request</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-url-list">url list</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-cereactions">CEReactions</span>
     <li><span class="dfn-paneled" id="term-for-htmlanchorelement">HTMLAnchorElement</span>
     <li><span class="dfn-paneled" id="term-for-the-a-element">a</span>
     <li><span class="dfn-paneled" id="term-for-environment-settings-object">environment settings object</span>
     <li><span class="dfn-paneled" id="term-for-following-hyperlinks-2">follow the hyperlink</span>
     <li><span class="dfn-paneled" id="term-for-obtain-a-site">obtain a site</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-relevant-settings-object">relevant settings object</span>
     <li><span class="dfn-paneled" id="term-for-rules-for-parsing-non-negative-integers">rules for parsing non-negative integers</span>
     <li><span class="dfn-paneled" id="term-for-same-origin">same origin</span>
     <li><span class="dfn-paneled" id="term-for-same-site">same site</span>
     <li><span class="dfn-paneled" id="term-for-concept-environment-top-level-origin">top-level origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-string">string</span>
     <li><span class="dfn-paneled" id="term-for-struct">struct</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-url-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-path">path</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-query">query</span>
     <li><span class="dfn-paneled" id="term-for-concept-url">url</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-parser">url parser</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-long-long">unsigned long long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#htmlanchorelement"><c- g>HTMLAnchorElement</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>, <a class="idl-code" data-link-type="extended-attribute"><c- g>Reflect</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString" href="#dom-htmlanchorelement-attributiondestination"><code><c- g>attributiondestination</c-></code></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>, <a class="idl-code" data-link-type="extended-attribute"><c- g>Reflect</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString" href="#dom-htmlanchorelement-attributionsourceeventid"><code><c- g>attributionsourceeventid</c-></code></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>, <a class="idl-code" data-link-type="extended-attribute"><c- g>Reflect</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString" href="#dom-htmlanchorelement-attributionreportto"><code><c- g>attributionreportto</c-></code></a>;
    [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>, <a class="idl-code" data-link-type="extended-attribute"><c- g>Reflect</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-type="unsigned long long" href="#dom-htmlanchorelement-attributionexpiry"><code><c- g>attributionexpiry</c-></code></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Patch into fetch for cancelling requests redirected to the .well-known
conversion domain.<a href="#issue-701ea956"> ↵ </a></div>
   <div class="issue"> Need monkey patches passing attribution source in navigation, and a mechanism
for validating the resulting document matches the attributiondestination.<a href="#issue-601c1f4b"> ↵ </a></div>
   <div class="issue"> Need to spec how to store the attribution source.<a href="#issue-f9c115e6"> ↵ </a></div>
   <div class="issue"> Formalize how to parse the query similar to URLSearchParams.<a href="#issue-9d1372db"> ↵ </a></div>
   <div class="issue"> Need to spec how to store <var>trigger</var>.<a href="#issue-03498328"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="element-attrdef-a-attributiondestination">
   <b><a href="#element-attrdef-a-attributiondestination">#element-attrdef-a-attributiondestination</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-attrdef-a-attributiondestination">1.1. Overview</a> <a href="#ref-for-element-attrdef-a-attributiondestination①">(2)</a> <a href="#ref-for-element-attrdef-a-attributiondestination②">(3)</a>
    <li><a href="#ref-for-element-attrdef-a-attributiondestination③">5.2. Obtaining an attribution source from an a element</a> <a href="#ref-for-element-attrdef-a-attributiondestination④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-attrdef-a-attributionsourceeventid">
   <b><a href="#element-attrdef-a-attributionsourceeventid">#element-attrdef-a-attributionsourceeventid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-attrdef-a-attributionsourceeventid">1.1. Overview</a>
    <li><a href="#ref-for-element-attrdef-a-attributionsourceeventid①">5.2. Obtaining an attribution source from an a element</a> <a href="#ref-for-element-attrdef-a-attributionsourceeventid②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-attrdef-a-attributionreportto">
   <b><a href="#element-attrdef-a-attributionreportto">#element-attrdef-a-attributionreportto</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-attrdef-a-attributionreportto">5.2. Obtaining an attribution source from an a element</a> <a href="#ref-for-element-attrdef-a-attributionreportto①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-attrdef-a-attributionexpiry">
   <b><a href="#element-attrdef-a-attributionexpiry">#element-attrdef-a-attributionexpiry</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-attrdef-a-attributionexpiry">5.2. Obtaining an attribution source from an a element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-source">
   <b><a href="#attribution-source">#attribution-source</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-source">1.1. Overview</a> <a href="#ref-for-attribution-source①">(2)</a>
    <li><a href="#ref-for-attribution-source">4.1. Attribution source</a>
    <li><a href="#ref-for-attribution-source②">5.2. Obtaining an attribution source from an a element</a>
    <li><a href="#ref-for-attribution-source③">5.6. Establishing report delivery time</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-source-source-origin">
   <b><a href="#attribution-source-source-origin">#attribution-source-source-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-source-source-origin">5.2. Obtaining an attribution source from an a element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-source-event-id">
   <b><a href="#attribution-source-event-id">#attribution-source-event-id</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-source-event-id">5.2. Obtaining an attribution source from an a element</a> <a href="#ref-for-attribution-source-event-id①">(2)</a>
    <li><a href="#ref-for-attribution-source-event-id②">5.5. Parsing data fields</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-source-attribution-destination">
   <b><a href="#attribution-source-attribution-destination">#attribution-source-attribution-destination</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-source-attribution-destination">5.2. Obtaining an attribution source from an a element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-source-reporting-endpoint">
   <b><a href="#attribution-source-reporting-endpoint">#attribution-source-reporting-endpoint</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-source-reporting-endpoint">5.2. Obtaining an attribution source from an a element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-source-expiry">
   <b><a href="#attribution-source-expiry">#attribution-source-expiry</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-source-expiry">5.2. Obtaining an attribution source from an a element</a>
    <li><a href="#ref-for-attribution-source-expiry①">5.6. Establishing report delivery time</a> <a href="#ref-for-attribution-source-expiry②">(2)</a> <a href="#ref-for-attribution-source-expiry③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-source-source-time">
   <b><a href="#attribution-source-source-time">#attribution-source-source-time</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-source-source-time">5.2. Obtaining an attribution source from an a element</a>
    <li><a href="#ref-for-attribution-source-source-time①">5.6. Establishing report delivery time</a> <a href="#ref-for-attribution-source-source-time②">(2)</a> <a href="#ref-for-attribution-source-source-time③">(3)</a> <a href="#ref-for-attribution-source-source-time④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-trigger">
   <b><a href="#attribution-trigger">#attribution-trigger</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-trigger">1.1. Overview</a>
    <li><a href="#ref-for-attribution-trigger">4.2. Attribution trigger</a>
    <li><a href="#ref-for-attribution-trigger①">5.3. Creating an attribution trigger</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-trigger-trigger-origin">
   <b><a href="#attribution-trigger-trigger-origin">#attribution-trigger-trigger-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-trigger-trigger-origin">5.3. Creating an attribution trigger</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-trigger-trigger-data">
   <b><a href="#attribution-trigger-trigger-data">#attribution-trigger-trigger-data</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-trigger-trigger-data">5.3. Creating an attribution trigger</a>
    <li><a href="#ref-for-attribution-trigger-trigger-data①">5.5. Parsing data fields</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-trigger-trigger-time">
   <b><a href="#attribution-trigger-trigger-time">#attribution-trigger-trigger-time</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-trigger-trigger-time">5.3. Creating an attribution trigger</a>
    <li><a href="#ref-for-attribution-trigger-trigger-time①">5.6. Establishing report delivery time</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-trigger-reporting-endpoint">
   <b><a href="#attribution-trigger-reporting-endpoint">#attribution-trigger-reporting-endpoint</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-trigger-reporting-endpoint">5.3. Creating an attribution trigger</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-report">
   <b><a href="#attribution-report">#attribution-report</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-report">3. HTML monkeypatches</a> <a href="#ref-for-attribution-report①">(2)</a>
    <li><a href="#ref-for-attribution-report">4.3. Attribution report</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="attribution-report-trigger-data">
   <b><a href="#attribution-report-trigger-data">#attribution-report-trigger-data</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attribution-report-trigger-data">5.3. Creating an attribution trigger</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parse-an-attribution-destination">
   <b><a href="#parse-an-attribution-destination">#parse-an-attribution-destination</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-an-attribution-destination">5.2. Obtaining an attribution source from an a element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="max-event-id-value">
   <b><a href="#max-event-id-value">#max-event-id-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-max-event-id-value">5.2. Obtaining an attribution source from an a element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="obtain-an-attribution-trigger">
   <b><a href="#obtain-an-attribution-trigger">#obtain-an-attribution-trigger</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-obtain-an-attribution-trigger">5.4. Triggering attribution</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="max-trigger-data-value">
   <b><a href="#max-trigger-data-value">#max-trigger-data-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-max-trigger-data-value">5.3. Creating an attribution trigger</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parse-attribution-data">
   <b><a href="#parse-attribution-data">#parse-attribution-data</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-attribution-data">5.2. Obtaining an attribution source from an a element</a>
    <li><a href="#ref-for-parse-attribution-data①">5.3. Creating an attribution trigger</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>